@*
 * Copyright 2020 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import iht.constants.IhtProperties
@import iht.controllers.CustomLanguageController
@import iht.utils.StringHelperFixture
@import iht.views.html.ihtHelpers.custom
@import iht.views.html.ihtHelpers.custom.full_width_banner
@import iht.views.html.ihtHelpers.standard
@import uk.gov.hmrc.play.language.LanguageUtils
@import uk.gov.hmrc.play.partials.FormPartialRetriever
@import iht.config.AppConfig
@import uk.gov.hmrc.play.views.html.layouts
@import play.twirl.api.HtmlFormat

@(title: String = "",
        signOutText: String = "",
        browserTitle: Option[String] = None,
        contentHeader: Option[Html] = None,
        isFullWidth: Boolean = false,
        backUrl: Option[Call] = None,
        cancelUrl: Option[Call]=None,
        cancelLabel: => Option[String] = Some(""),
        hasTimeOut:Boolean = true,
        sidebarLinks: Html = HtmlFormat.empty,
        signOutUrl: Option[Call],
        headerTitle: Option[String],
        headingClass: String = "",
        headingName: String = "",
        isRegistration: Boolean = false,
        highlightBoxClass:Option[String] = None,
        optionContentBelowTitle: Option[Html] = None
)(mainContent: Html)(
        implicit request:Request[_],
        messages: Messages,
        ihtFormPartialRetriever: FormPartialRetriever,
        appConfig: AppConfig)

@currentLang = @{messages.lang.language}

@headingClassName() = @{
    if(headingClass != ""){
        headingClass
    }else{
        if(StringHelperFixture().isNameLong(headingName)){
            "heading-large"
        } else {
            "heading-xlarge"
        }
    }
}

@parseForName(heading: String, name: String) = @{
    if(heading contains name){
        Html(heading.replace(name, custom.name(name).toString()));
    } else {
        heading;
    }
}

@navLinks = {
@signOutUrl.map{ url =>
    <li class="u--no-print"><a class="link--no-underline" id="logOutNavHref" href="@url">@signOutText</a></li>
}
}

@linkElement = {
    <link rel="stylesheet" href='@routes.Assets.versioned("stylesheets/iht-app.css")' />
        <!--[if lte IE 8 ]>
    <link rel="stylesheet" href="@routes.Assets.versioned("stylesheets/iht-app-ie.css")" />
    <![endif]-->
    <link rel="stylesheet" media="print" href='@routes.Assets.versioned("stylesheets/iht-print.css")' />
}

@scriptElement = {
@if(appConfig.analyticsToken.contains("N/A")) {
    <script type="text/javascript">
            var ga = function(send, event, category, action, label, args) {
                console.log(JSON.stringify({
                    call: 'ga',
                    send: send,
                    event: event,
                    category: category,
                    action: action,
                    label: label
                }));

                if (args && typeof args['hitCallback'] === 'function' ) {
                    args['hitCallback']();
                }
            };
    </script>
}

    <script src='@routes.Assets.versioned("javascripts/gaTracking.js")' type="text/javascript"></script>

    <script src="https://cdn.optimizely.com/js/8390718215.js"></script>

    <script src='@routes.Assets.versioned("javascripts/iht-app.min.js")'> </script>
@if(hasTimeOut && appConfig.enableRefresh) {
    <script>
            $.timeoutDialog({
                timeout: @appConfig.timeOutSeconds,
                countdown: @appConfig.timeOutCountdownSeconds,
                keep_alive_url: "@iht.controllers.routes.SessionManagementController.keepAlive.url",
                title: "@Messages("iht.timeoutDialog.title")",
                messageSeconds: "@Messages("iht.timeoutDialog.seconds")",
                    messageMinutes: "@Messages("iht.timeoutDialog.minutes")",
                    messageMinute: "@Messages("iht.timeoutDialog.minute")",
                    messageMinutesTwo: "@Messages("iht.timeoutDialog.minutes.two")",

                    @if(isRegistration){
                    logout_url: "@iht.controllers.routes.SessionTimeoutController.onRegistrationPageLoad().url",
                    message: "@Messages("iht.timeoutDialog.registration.p1")",
                    keep_alive_button_text: "@Messages("iht.timeoutDialog.registration.button")"
            } else {
            logout_url: "@iht.controllers.routes.SessionTimeoutController.onApplicationPageLoad().url",
                    message: "@Messages("iht.timeoutDialog.p1")",
                    keep_alive_button_text: "@Messages("iht.timeoutDialog.button")"
            }
            });
            var dialogOpen;
    </script>
}
}

    @commonContentHeader = {
    @if(appConfig.isWelshEnabled){
        @{
            standard.language_selection(
                Map(
                    "english" -> Lang("en"),
                    "cymraeg" -> Lang("cy")
                ),
                (lang: String) => iht.controllers.routes.CustomLanguageController.switchToLanguage(lang),
                Some("translate float--right u--no-print")
            )
        }
    }
    @contentHeader
}

    @insideHeader = {
    @standard.header_nav(headerTitle, None, Some(navLinks))
    @if(appConfig.googleTagManagerId != "N/A") {
    <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=@appConfig.googleTagManagerId" height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>
    }
}

    @mainContentIht = {
    @if(title > ""){
        @highlightBoxClass.map{css=>
            <div class="@css">
        }
        <h1 class="@headingClassName">
        @if(headingName > ""){
            @parseForName(title, headingName)
        } else {
            @Html(title)
        }
        </h1>
        @optionContentBelowTitle.map{content=>
            @content
        }
        @highlightBoxClass.map{_=>
        </div>
        }
    }
    @mainContent

    @backUrl.map{ url =>
        <a id="back-button" class="back-link" href=@url>@Messages("iht.back")</a>
    }
    @cancelUrl.map{ url =>
        <p>
            <a id="cancel-button" class="" href=@url>@Html(cancelLabel.getOrElse(""))</a>
        </p>
    }
}

    @serviceInfo = {
    @standard.serviceInfo(
        includeGridWrapper = false,
        serviceInfoContent = None)
}

    @content = {
    @layouts.main_content(
        article = standard.article(content = mainContentIht,
            includeGridWrapper = false,
            isFullWidth = isFullWidth,
            currentLang = currentLang),
        mainContentHeader = commonContentHeader,
        serviceInfo = serviceInfo,
        getHelpForm = custom.progressive_disclosure(request.uri),
        sidebar = standard.sidebar(sidebarLinks = sidebarLinks,
            sidebarClass = Some("sidebar"),
            currentLang = currentLang)
    )
}

    @bodyEnd = {
    @layouts.footer(
        analyticsToken = appConfig.analyticsToken,
        analyticsHost = appConfig.analyticsHost,
        ssoUrl = None,
        scriptElem = Some(scriptElement),
        gaCalls = None
    )
}

    @headScripts = {
        @if(appConfig.googleTagManagerId != "N/A") {
            <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
              new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
              j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
              'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
              })(window,document,'script','dataLayer','@appConfig.googleTagManagerId');
            </script>
        }

}

@views.html.layouts.govuk_template(
    title = if(browserTitle.isDefined) { browserTitle.map(_ + " " + Messages("site.title.govuk")) } else Some(title),
    bodyClasses = None)(
    head = layouts.head(linkElem = Some(linkElement), headScripts = Some(headScripts)),
    bodyEnd = bodyEnd,
    insideHeader = insideHeader,
    afterHeader = HtmlFormat.empty,
    footerTop = HtmlFormat.empty,
    footerLinks = Some(iht.views.html.ihtHelpers.standard.footer_links()),
    nav = true)(content)
